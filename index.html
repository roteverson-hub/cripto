<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cripto3 - Desafio Di√°rio</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">

    <!-- üîπ Tela de Login -->
    <div id="login-section">
      <h1>Login</h1>
      <input type="text" id="login-username" placeholder="Usu√°rio">
      <input type="password" id="login-password" placeholder="Senha">
      <button class="btn" id="btnLogin">Entrar</button>
      <p>Ainda n√£o tem conta? <a href="#" id="goRegister">Registrar</a></p>
      <p id="loginMsg" class="result-message"></p>
    </div>

    <!-- üîπ Tela de Registro -->
    <div id="register-section" style="display:none;">
      <h1>Registrar</h1>
      <input type="text" id="register-username" placeholder="Usu√°rio">
      <input type="password" id="register-password" placeholder="Senha">
      <button class="btn" id="btnRegister">Criar Conta</button>
      <p>J√° tem conta? <a href="#" id="goLogin">Login</a></p>
      <p id="registerMsg" class="result-message"></p>
    </div>

    <!-- üîπ Tela do Jogo -->
    <div id="game-section" style="display:none;">
      <h1>CRIPTO3 ‚Äì Desafio Di√°rio</h1>
      <p id="welcome"></p>
      <p id="theme" class="theme-text"></p>
      <div id="challenge" class="challenge-container"></div>
      <button id="loadChallenge" class="btn">Carregar Desafio do Dia</button>
      <button id="submitAnswers" class="btn" style="display: none;">Enviar Respostas</button>
      <p id="result" class="result-message"></p>
      <button id="logout" class="btn" style="background:#d9534f; display:none;">Sair</button>
    </div>
  </div>

  <script>
    // üîπ Endpoints
    const CHALLENGE_URL = "/api/challenge";
    const LOGIN_URL = "/api/login";
    const REGISTER_URL = "/api/register";

    let originalWords = [];

    // =========================
    // üîπ Persist√™ncia de Login
    // =========================
    function checkLogin() {
      const user = localStorage.getItem("user");
      if (user) {
        document.getElementById("login-section").style.display = "none";
        document.getElementById("register-section").style.display = "none";
        document.getElementById("game-section").style.display = "block";
        document.getElementById("welcome").textContent = `üëã Bem-vindo, ${user}!`;
        document.getElementById("logout").style.display = "block";
      }
    }
    checkLogin();

    document.getElementById("logout").addEventListener("click", () => {
      localStorage.removeItem("user");
      location.reload();
    });

    // =========================
    // üîπ Troca de Telas
    // =========================
    document.getElementById("goRegister").addEventListener("click", () => {
      document.getElementById("login-section").style.display = "none";
      document.getElementById("register-section").style.display = "block";
    });

    document.getElementById("goLogin").addEventListener("click", () => {
      document.getElementById("register-section").style.display = "none";
      document.getElementById("login-section").style.display = "block";
    });

    // =========================
    // üîπ Registro
    // =========================
    document.getElementById("btnRegister").addEventListener("click", async () => {
      const username = document.getElementById("register-username").value;
      const password = document.getElementById("register-password").value;

      try {
        const res = await fetch(REGISTER_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        document.getElementById("registerMsg").textContent = data.message;

        if (data.success) {
          document.getElementById("register-section").style.display = "none";
          document.getElementById("login-section").style.display = "block";
        }
      } catch (err) {
        document.getElementById("registerMsg").textContent = "Erro ao registrar.";
      }
    });

    // =========================
    // üîπ Login
    // =========================
    document.getElementById("btnLogin").addEventListener("click", async () => {
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      try {
        const res = await fetch(LOGIN_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        document.getElementById("loginMsg").textContent = data.message;

        if (data.success) {
          localStorage.setItem("user", username);
          document.getElementById("login-section").style.display = "none";
          document.getElementById("game-section").style.display = "block";
          document.getElementById("welcome").textContent = `üëã Bem-vindo, ${username}!`;
          document.getElementById("logout").style.display = "block";
        }
      } catch (err) {
        document.getElementById("loginMsg").textContent = "Erro ao logar.";
      }
    });

    // =========================
    // üîπ Carregar Desafio
    // =========================
    document.getElementById('loadChallenge').addEventListener('click', async () => {
      try {
        const response = await fetch(CHALLENGE_URL);
        const data = await response.json();

        document.getElementById('theme').textContent = `Tema: ${data.theme}`;
        originalWords = data.original;

        const challengeDiv = document.getElementById('challenge');
        challengeDiv.innerHTML = '';
        data.words.forEach((word, index) => {
          const div = document.createElement('div');
          div.classList.add('challenge-word');
          div.innerHTML = `
            <p>${word}</p>
            <input type="text" id="input-${index}" placeholder="Digite a palavra correta">
            <span id="feedback-${index}"></span>
          `;
          challengeDiv.appendChild(div);
        });

        document.getElementById('loadChallenge').style.display = "none";
        document.getElementById('submitAnswers').style.display = "block";

      } catch (err) {
        console.error(err);
        alert("Erro ao carregar desafio do dia.");
      }
    });

    // =========================
    // üîπ Verificar Respostas
    // =========================
    document.getElementById('submitAnswers').addEventListener('click', () => {
      let correctCount = 0;

      originalWords.forEach((answer, index) => {
        const input = document.getElementById(`input-${index}`);
        const feedback = document.getElementById(`feedback-${index}`);

        if (input.value.trim().toUpperCase() === answer.toUpperCase()) {
          feedback.textContent = " ‚úÖ";
          feedback.className = "correct";
          correctCount++;
        } else {
          feedback.textContent = " ‚ùå";
          feedback.className = "wrong";
        }
      });

      const resultMsg = document.getElementById("result");
      if (correctCount === originalWords.length) {
        resultMsg.textContent = "üéâ Parab√©ns! Voc√™ acertou todas!";
        resultMsg.style.color = "#4CAF50";
      } else {
        resultMsg.textContent = `Voc√™ acertou ${correctCount} de ${originalWords.length}.`;
        resultMsg.style.color = "#FFB300";
      }
    });
  </script>
</body>
</html>
